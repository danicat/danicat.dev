{{ define "main" }}
  <div class="container mx-auto px-4">
    <h1 class="text-4xl font-bold text-center my-8">{{ .Title }}</h1>

    {{ $events := (.Pages.ByParam "eventStartDate").Reverse }}
    {{ $groupedEvents := $events.GroupByDate "2006" "desc" }}

    {{ range $groupedEvents }}
      <h2 class="text-2xl font-bold my-4">{{ .Key }}</h2>
      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {{ range .Pages }}
          <div class="border border-neutral-200 dark:border-neutral-700 rounded-lg overflow-hidden shadow-lg">
            {{ if .Params.featuredImage }}
              {{ $imagePath := .Params.featuredImage }}
              {{ $externalImage := and $imagePath (or (hasPrefix $imagePath "http://") (hasPrefix $imagePath "https://")) }}
              <a href="{{ .Permalink }}">
                <div class="w-full h-48 bg-cover bg-center" style="background-image:url('{{ if $externalImage }}{{ $imagePath }}{{ else }}{{ $imagePath | absURL }}{{ end }}');"></div>
              </a>
            {{ end }}
            <div class="p-6">
              <h3 class="font-bold text-xl mb-2">
                <a href="{{ .Permalink }}">{{ .Title }}</a>
              </h3>
              <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-2">
                {{ .Params.eventStartDate | time.Format ":date_long" }}
                {{ if .Params.eventEndDate }}
                  - {{ .Params.eventEndDate | time.Format ":date_long" }}
                {{ end }}
              </p>
              <p class="text-neutral-700 dark:text-neutral-300">{{ .Summary | plainify | truncate 120 }}</p>
              {{ if .Params.eventUrl }}
                <div class="mt-4">
                  <a href="{{ .Params.eventUrl }}" class="text-primary-600 dark:text-primary-400 hover:underline" target="_blank" rel="noopener">
                    {{ i18n "event_details_link" | default "Event Details &rarr;" | safeHTML }}
                  </a>
                </div>
              {{ end }}
            </div>
          </div>
        {{ end }}
      </div>
    {{ end }}
  </div>
{{ end }}
